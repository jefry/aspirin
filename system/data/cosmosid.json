{"key":"edit","source":"\nDNO.open('cosmosid').findOne({key:just.name})\n  .then(v=>editor.setValue(v.source))\n\n","_id":"3sciGKoyHXVozWIQ"}
{"key":"CID_API","source":"f = '/Users/rainerg/work/globallogic/___SAMPLES___/CID_API.json'\n\ndata = jetpack.read(f, 'json')\n\n\nObject.keys(data.paths)\n\n\ndata.paths","_id":"D7UKr4tQkB5gbG5A"}
{"key":"s3_list1","source":"\nfile = \"/Users/rainerg/work/globallogic/AWS/cosmosid-genius-production_filelist.txt\"\nfile2 = \"/Users/rainerg/work/globallogic/AWS/samples_IDlist.txt\"\n\ndata = jetpack.read(file)\n\n\n\nlines = data.split('\\n').map(l=>l.trim().split(' '));\n\n\n//lines.length\n\nline = lines[1998]\nline = lines[1995]\n//line = lines[17360]\n\n\n\nout = lines.filter(parts=>{\n  return parts[0]==\"PRE\"&&parts[1].length == 37;\n})\n\n\nout = out.map(p=>p[1].substr(0,36))\n//out.length\n\n\n//t = \"00005481-0087-88f8-9d7d-8ababaaa8423/\"\n//t.substr(0,36)\n\n\n//jetpack.write(file2, out.join('\\n'))","_id":"QLBAfxi8iqybsJ4y"}
{"key":"getPricing-fn","source":"\n\ninput = [\n  {\n    sample_key: \"Xxxx-4xxx\",\n    extension: 'fastq.gz',//<enum: (bam, fastq.gz, fasta etc...)>\n    file_sizes : [10000, 20000]\n  },\n  {\n    sample_key: \"Yxxx-4xxx\",\n    extension: 'fastq',//<enum: (bam, fastq.gz, fasta etc...)>\n    file_sizes : [30000, 40000]\n  }\n];\n\n\nTHRESHOLD = 40000;\n\ngetPricingForSample = (sample)=>{\n  const fileSizesSumm = sample.file_sizes.reduce((m,v)=>m+v)\n\n  const is_shallow = fileSizesSumm < THRESHOLD;\n  return {\n    sample_key: sample.sample_key,\n    pricing: {\n      2: is_shallow ? 2.0 : 4.0,\n      6: 1.0,\n      7: 1.0,\n      8: 1.0\n    },\n    is_shallow:{\n      2: is_shallow,\n      6: false,\n      7: false,\n      8: false\n    }\n  }\n}\n\n\ninput.map(getPricingForSample)\n\n\n\n","_id":"WrIXGP51r5tXwzdj"}
{"key":"FILE_SIZE_PRICING","source":"\nFILE_SIZE_PRICING_THRESHOLD = {\n  'bam': 0.01055009335,\n  'fasta': 0.00511591268,\n  'fna': 0.00511591268,\n  'fasta.gz': 0.01993468654,\n  'fastq': 0.002842851724,\n  'fq':  0.002842851724,\n  'fastq.gz': 0.008387532175,\n  'sra': 0.007012547092,\n}\n\n\t\t\t\t\t\nFILE_SIZE_SHALLOW_LIMIT = 3000000\n\nis_shallow =  (file_size,extension) => \n  file_size * FILE_SIZE_PRICING_THRESHOLD[extension] < FILE_SIZE_SHALLOW_LIMIT\n\n\nis_shallow2 =  (file_size,extension) => \n  file_size * FILE_SIZE_PRICING_THRESHOLD[extension]\n\n\n\nfsz = 1024*1024*1024*1\n\nout = Object.keys(FILE_SIZE_PRICING_THRESHOLD).map(ext=>[ext, is_shallow2(fsz,ext)])\n\n\ncolf(out)","_id":"cnuUWKUZjiMniT8p"}
{"key":"Sort_cohort","source":"\na = [{\"UUID\":\"8ff3c53e-cecd-4432-aac1-0397ef304548\",\"File name\":\"zymo_spike_in_2.fastq.gz\",\"Folder\":\"root*\",\"Size\":\"13 MB\",\"Submitted\":\"2020-04-24 15:04\",\"Strains\":2,\"Display name\":\"zymo_spike_in_2.fastq.gz\",\"Cohort\":\"Cohort 6\",\"Cohort Order\":\"6\"},{\"UUID\":\"358416fa-0bcd-4ea4-b8b7-f028e0345e4a\",\"File name\":\"zymo_spike_in_2.1.fastq.gz\",\"Folder\":\"root*\",\"Size\":\"13 MB\",\"Submitted\":\"2020-04-24 15:04\",\"Strains\":2,\"Display name\":\"zymo_spike_in_2.1.fastq.gz\",\"Cohort\":\"Cohort 5\",\"Cohort Order\":\"5\"},{\"UUID\":\"a498701f-c9fc-4788-8d31-32631cf98ec9\",\"File name\":\"zymo_spike_in_2.1.fastq.gz\",\"Folder\":\"root*\",\"Size\":\"17 MB\",\"Submitted\":\"2020-04-24 15:04\",\"Strains\":2,\"Display name\":\"zymo_spike_in_2.1.fastq.gz\",\"Cohort\":\"Cohort 4\",\"Cohort Order\":\"4\"},{\"UUID\":\"f3047bb4-ba3d-4768-8521-61293eafe5bc\",\"File name\":\"zymo_community_1.fastq.gz\",\"Folder\":\"root*\",\"Size\":\"14 MB\",\"Submitted\":\"2020-04-24 15:04\",\"Strains\":9,\"Display name\":\"zymo_community_1.fastq.gz\",\"Cohort\":\"Cohort 3\",\"Cohort Order\":\"3\"},{\"UUID\":\"a1c44e8e-3521-46ad-a5d5-e5ec2629b29b\",\"File name\":\"zymo_community_2_log.fastq.gz\",\"Folder\":\"root*\",\"Size\":\"1 GB\",\"Submitted\":\"2020-04-01 13:04\",\"Strains\":9,\"Display name\":\"zymo_community_2_log.fastq.gz\",\"Cohort\":\"Cohort 2\",\"Cohort Order\":\"2\"},{\"UUID\":\"532a2864-1bb2-4419-b499-ba0ad71c5182\",\"File name\":\"zymo_community_2_log.fastq.gz\",\"Folder\":\"root*\",\"Size\":\"1 GB\",\"Submitted\":\"2020-04-01 13:04\",\"Strains\":9,\"Display name\":\"zymo_community_2_log.fastq.gz\",\"Cohort\":\"Cohort 1(baseline)\",\"Cohort Order\":\"1\"},{\"UUID\":\"b552f098-422e-4e42-8387-2aa4a44301e3\",\"File name\":\"zymo_community_1.fastq.gz\",\"Folder\":\"root*\",\"Size\":\"14 MB\",\"Submitted\":\"2020-04-01 13:04\",\"Strains\":9,\"Display name\":\"zymo_community_1.fastq.gz\",\"Cohort\":\"No Cohort\",\"Cohort Order\":\"0\"},{\"UUID\":\"146b8184-5a41-4bee-bb90-c78d24caca11\",\"File name\":\"att_k_ging_SRS013946.fasta\",\"Folder\":\"root*\",\"Size\":\"10 GB\",\"Submitted\":\"2017-07-28 15:07\",\"Strains\":177,\"Display name\":\"att_k_ging_SRS013946.fasta\",\"Cohort\":\"\",\"Cohort Order\":\"\"},{\"UUID\":\"4abc1fe3-f236-4b98-aa74-c910f42cf3e0\",\"File name\":\"att_k_ging_SRS014473.fasta\",\"Folder\":\"root*\",\"Size\":\"4 GB\",\"Submitted\":\"2017-07-28 15:07\",\"Strains\":168,\"Display name\":\"att_k_ging_SRS014473.fasta\",\"Cohort\":\"\",\"Cohort Order\":\"\"},{\"UUID\":\"49c020e8-aea1-4eaf-8d2d-c453f6ad0975\",\"File name\":\"att_k_ging_SRS015060.fasta\",\"Folder\":\"root*\",\"Size\":\"2 GB\",\"Submitted\":\"2017-07-28 15:07\",\"Strains\":176,\"Display name\":\"att_k_ging_SRS015060.fasta\",\"Cohort\":\"\",\"Cohort Order\":\"\"},{\"UUID\":\"e26f73c9-8efd-4309-90d0-6423390b1f5d\",\"File name\":\"att_k_ging_SRS019025.fasta\",\"Folder\":\"root*\",\"Size\":\"1 GB\",\"Submitted\":\"2017-07-28 15:07\",\"Strains\":196,\"Display name\":\"att_k_ging_SRS019025.fasta\",\"Cohort\":\"\",\"Cohort Order\":\"\"},{\"UUID\":\"67657c32-a706-4b73-9ad0-6ce215bafc44\",\"File name\":\"att_k_ging_SRS019125.fasta\",\"Folder\":\"root*\",\"Size\":\"4 GB\",\"Submitted\":\"2017-07-28 15:07\",\"Strains\":118,\"Display name\":\"att_k_ging_SRS019125.fasta\",\"Cohort\":\"\",\"Cohort Order\":\"\"},{\"UUID\":\"dbb0c7a9-8ede-4dc0-aeb0-80db8f2a3c1c\",\"File name\":\"buc_muc_SRS013711.fasta\",\"Folder\":\"root*\",\"Size\":\"1 GB\",\"Submitted\":\"2017-07-28 15:07\",\"Strains\":256,\"Display name\":\"buc_muc_SRS013711.fasta\",\"Cohort\":\"\",\"Cohort Order\":\"\"},{\"UUID\":\"e9917d96-152f-48c6-ad9b-8e8dd16f5794\",\"File name\":\"buc_muc_SRS015985.fasta\",\"Folder\":\"root*\",\"Size\":\"2 GB\",\"Submitted\":\"2017-07-28 15:07\",\"Strains\":205,\"Display name\":\"buc_muc_SRS015985.fasta\",\"Cohort\":\"\",\"Cohort Order\":\"\"},{\"UUID\":\"211a23e6-dce7-49dd-a245-eb64ed8e978f\",\"File name\":\"buc_muc_SRS018359.fasta\",\"Folder\":\"root*\",\"Size\":\"879 MB\",\"Submitted\":\"2017-07-28 15:07\",\"Strains\":166,\"Display name\":\"buc_muc_SRS018359.fasta\",\"Cohort\":\"\",\"Cohort Order\":\"\"},{\"UUID\":\"a9830860-9a00-498e-a18b-ecb40c360929\",\"File name\":\"buc_muc_SRS021473.fasta\",\"Folder\":\"root*\",\"Size\":\"1 GB\",\"Submitted\":\"2017-07-28 15:07\",\"Strains\":203,\"Display name\":\"buc_muc_SRS021473.fasta\",\"Cohort\":\"\",\"Cohort Order\":\"\"}]\n\na = a.map(v=>({'File name':v['File name'],'Cohort':v['Cohort'],'Cohort Order':v['Cohort Order']}))\n\n\nsofn = (key)=>(a, b) => {\n  const oa = a[key] == '' ? 100 : a[key];\n\n  const ob = b[key] == '' ? 100 : b[key];\n\n  return ob - oa;\n}\n\n\nmafn = (key)=>(a) => {\n  const oa = a[key] == '' ? 100 : a[key];\n\n  //const ob = b[key] == '' ? 0 : b[key];\n\n  return {oa}// - ob;\n}\n\n\n//aa = a.map(mafn(\"Cohort Order\"));\naa = a.sort(sofn(\"Cohort Order\"));\n\n\n\ncolf(aa)","_id":"oEzhclqfL5fgHVUc"}
