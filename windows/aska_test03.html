<script type="text/javascript" src="F:/ajr/aspirin/resources/p5.js"></script>
<script type="text/javascript" src="F:/ajr/aspirin/resources/p5.sound.js"></script>
<script type="text/javascript" src="F:/ajr/aspirin/resources/p5.gif.js"></script>
<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  </head>
  <style>
    ::-webkit-scrollbar { width: 0 !important }

    body{
      width:90%;
      background: rgba(10, 10, 10, 0);
      color: white;
    }
  </style> 
  <body>
    <div id="run"></div>
  </body>
</html>
<script type="text/javascript">

  document.getElementById('run').innerHTML += 
    '<audio src="" id="audio"><audio/>';

  var gif, pg, sound, amplitude, cnv;
  var jetpack = require('fs-jetpack')
  let zzz2 = windowManager.sharedData.fetch('x_code_get_id');
  function preload() {
    var text2 = jetpack.read('F:/ajr/aspirin/windows/aska_test03_buffer.json','json'); 
   // console.log(text2)
    var text = text2[0]
    var url = 'https:/tts.voicetech.yandex.net/generate?'+
        'key=ddf051c8-8d90-4912-bccb-9fd85f0e21db'+
        '&text='+text+
        '&format=mp3'+
        '&lang=ru-RU'+
        '&topic=queries'+
        'speed=2'+
        '&robot=1'+
        '&emotion=evil';
    mySound = loadSound(url);
  }

  function setup() {
    createCanvas(1200,1080);
    mySound.setVolume(2);
    mySound.play();
    amplitude = new p5.Amplitude();
  }

  function draw() {
    clear();
    //background(0,0,0,0);
    //image(gif,30,30);
    var level = amplitude.getLevel();
    level = level*2000|0
    //console.log(level)
    //translate(level, level);
    var lx = 150
    let ly = 550
    var x_otstyp = 20
    var size = 6
    var degrice = 0.2
    level = level*0.01
    fill('red')
    
    rect(lx, ly-level, size, (level/0.5));
    lx = lx + x_otstyp
    level = level*(1+degrice)
    rect(lx, ly-level, size, (level/0.5));
    lx = lx + x_otstyp
    level = level*(1+degrice)
    rect(lx, ly-level, size, (level/0.5));
    lx = lx + x_otstyp
    level = level*(1+degrice)
    rect(lx, ly-level, size, (level/0.5));
    lx = lx + x_otstyp
    level = level*(1+degrice)
    rect(lx, ly-level, size, (level/0.5));
    lx = lx + x_otstyp
    level = level*(1+degrice)
    rect(lx, ly-level, size, (level/0.5));
    lx = lx + x_otstyp
    level = level*(1+degrice)
    rect(lx, ly-level, size, (level/0.5));
    lx = lx + x_otstyp
    level = level*(1+degrice)
    rect(lx, ly-level, size, (level/0.5));
    lx = lx + x_otstyp
    level = level*(1+degrice)
    rect(lx, ly-level, size, (level/0.5));
    lx = lx + x_otstyp
    level = level*(1+degrice)
    rect(lx, ly-level, size, (level/0.5));
    lx = lx + x_otstyp
    level = level*(1+degrice)
    rect(lx, ly-level, size, (level/0.5));
    lx = lx + x_otstyp
    level = level*(1+degrice)
    rect(lx, ly-level, size, (level/0.5));
    lx = lx + x_otstyp
    level = level*(1+degrice)
    rect(lx, ly-level, size, (level/0.5));
    lx = lx + x_otstyp
    level = level*(1+degrice)
    rect(lx, ly-level, size, (level/0.5));
    lx = lx + x_otstyp
    level = level*(1+degrice)
    rect(lx, ly-level, size, (level/0.5));
    lx = lx + x_otstyp
    level = level*(1+degrice)
    rect(lx, ly-level, size, (level/0.5));
    lx = lx + x_otstyp
    level = level*(1+degrice)
    rect(lx, ly-level, size, (level/0.5));
    lx = lx + x_otstyp
    level = level*(1+degrice)
    rect(lx, ly-level, size, (level/0.5));
    lx = lx + x_otstyp
    level = level*(1+degrice)
    rect(lx, ly-level, size, (level/0.5));
    lx = lx + x_otstyp
    level = level*(1+degrice)
    rect(lx, ly-level, size, (level/0.5));
    lx = lx + x_otstyp
    level = level*(1+degrice)
    rect(lx, ly-level, size, (level/0.5));
    lx = lx + x_otstyp
    level = level*(1+degrice)
    rect(lx, ly-level, size, (level/0.5));
   
    lx = lx + x_otstyp
    rect(lx, ly-level, size, (level/0.5));
    lx = lx + x_otstyp
    level = level*(1-degrice)
    rect(lx, ly-level, size, (level/0.5));
    lx = lx + x_otstyp
    level = level*(1-degrice)
    rect(lx, ly-level, size, (level/0.5));
    lx = lx + x_otstyp
    level = level*(1-degrice)
    rect(lx, ly-level, size, (level/0.5));
    lx = lx + x_otstyp
    level = level*(1-degrice)
    rect(lx, ly-level, size, (level/0.5));
    
  }
  
  function window_close(time){
    let sec = 0
    let iid = setInterval(int_timer, 1000);
    function int_timer(){
      sec+=1
      if(time < sec){
        let cl = require('electron').remote.BrowserWindow.fromId(zzz2)
        clearInterval(iid)
        cl.close()
      }
    }   
  }
  var text3 = jetpack.read('F:/ajr/aspirin/windows/aska_test03_buffer.json','json'); 
  let delay = text3[1]
  window_close(delay)
</script>
